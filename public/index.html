
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>è·è˜­å¼æ‹è³£ v2.2</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    #admin-panel, #auction-info, #history, #current-price { margin-top: 20px; }
    input, button { margin: 5px; padding: 8px; }
  </style>
</head>
<body>
  <h1>è·è˜­å¼æ‹è³£ç³»çµ± v2.2</h1>

  <div id="login-panel">
    <input type="password" id="admin-password" placeholder="è¼¸å…¥ä¸»æŒäººå¯†ç¢¼">
    <button onclick="login()">ä¸»æŒäººç™»å…¥</button>
  </div>

  <div id="admin-panel" style="display:none;">
    <h2>ä¸»æŒäººæ§åˆ¶å°</h2>
    <input type="text" id="item" placeholder="è¼¸å…¥æ‹è³£å“åç¨±">
    <input type="number" id="startPrice" placeholder="èµ·å§‹åƒ¹æ ¼">
    <input type="number" id="minPrice" placeholder="åº•åƒ¹">
    <input type="number" id="interval" placeholder="æ¯æ¬¡é™åƒ¹é–“éš”(ms)">
    <input type="number" id="decrease" placeholder="æ¯æ¬¡é™åƒ¹é‡‘é¡">
    <button onclick="previewAuction()">ğŸ“¢ æ‹è³£é å‘Š</button>
    <button onclick="startAuction()">ğŸ¬ é–‹å§‹æ‹è³£</button>
    <button onclick="stopAuction()">ğŸ›‘ çµæŸæ‹è³£</button>
    <button onclick="clearHistory()">ğŸ—‘ æ¸…é™¤å¾—æ¨™ç´€éŒ„</button>
  </div>

  <div id="join-panel">
    <input type="text" id="username" placeholder="è¼¸å…¥æ‚¨çš„åç¨±">
    <button onclick="joinAuction()">åŠ å…¥æ‹è³£</button>
  </div>

  <div id="auction-info" style="display:none;">
    <h2>æ­£åœ¨æ‹è³£ï¼š<span id="itemName"></span></h2>
    <div id="current-price" style="font-size: 36px;">åƒ¹æ ¼å€’æ•¸ä¸­...</div>
    <button onclick="bid()">ğŸ’° å‡ºåƒ¹</button>
  </div>

  <div id="history">
    <h3>å¾—æ¨™ç´€éŒ„</h3>
    <ul id="winner-list"></ul>
  </div>

  <script>
    let socket = io();
    let isHost = false;
    let user = '';

    function login() {
      const pw = document.getElementById('admin-password').value;
      if (pw === "flower123") {
        isHost = true;
        document.getElementById('login-panel').style.display = 'none';
        document.getElementById('admin-panel').style.display = 'block';
      } else {
        alert("å¯†ç¢¼éŒ¯èª¤");
      }
    }

    function joinAuction() {
      user = document.getElementById("username").value;
      if (!user) return alert("è«‹è¼¸å…¥åç¨±");
      document.getElementById("join-panel").style.display = "none";
    }

    function previewAuction() {
      const data = collectAuctionData();
      if (!data) return;
      socket.emit("preview", data);
    }

    function startAuction() {
      const data = collectAuctionData();
      if (!data) return;
      socket.emit("start", data);
    }

    function stopAuction() {
      socket.emit("stop");
    }

    function clearHistory() {
      socket.emit("clear");
      document.getElementById("winner-list").innerHTML = "";
    }

    function bid() {
      socket.emit("bid", { user });
    }

    function collectAuctionData() {
      const item = document.getElementById("item").value;
      const start = parseFloat(document.getElementById("startPrice").value);
      const min = parseFloat(document.getElementById("minPrice").value);
      const interval = parseInt(document.getElementById("interval").value);
      const decrease = parseFloat(document.getElementById("decrease").value);
      if (!item || isNaN(start) || isNaN(min) || isNaN(interval) || isNaN(decrease)) {
        alert("è«‹å¡«å…¥æ‰€æœ‰æ‹è³£è³‡æ–™");
        return null;
      }
      return { item, start, min, interval, decrease };
    }

    socket.on("preview", ({ item, start }) => {
      document.getElementById("itemName").innerText = `${item}ï¼ˆå³å°‡ä»¥ $${start} æ‹è³£ï¼‰`;
      document.getElementById("auction-info").style.display = "block";
    });

    socket.on("update", ({ item, price }) => {
      document.getElementById("itemName").innerText = item;
      document.getElementById("current-price").innerText = `$${price}`;
      document.getElementById("auction-info").style.display = "block";
    });

    socket.on("winner", ({ user, item, price }) => {
      const li = document.createElement("li");
      li.textContent = `${user} å¾—æ¨™ã€Œ${item}ã€ï¼Œåƒ¹æ ¼ $${price}`;
      document.getElementById("winner-list").prepend(li);
      document.getElementById("auction-info").style.display = "none";
    });

    socket.on("clear", () => {
      document.getElementById("winner-list").innerHTML = "";
    });

    socket.on("stop", () => {
      document.getElementById("auction-info").style.display = "none";
    });
  </script>
  <script src="/socket.io/socket.io.js"></script>
</body>
</html>
